{
  "hash": "59da244ae37a5d5dbe3a35ce7dff4d7e",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"From Traffic Flow to Numerical Schemes\"\nformat:\n  html:\n    toc: true\n    number-sections: false\n    code-fold: true\n    code-summary: \"Show code\"\n    embed-resources: true\njupyter: python3\nexecute:\n  echo: false\n  warning: false\n  message: false\n  cache: true\n  freeze: auto\n  jupyter-widgets: true\n---\n\nWe just modeled traffic flow and arrived at the linear transport (advection) equation\n\n$$\nu_t + a\\,u_x = 0,\\qquad a>0,\n$$\n\nwhere $u(x,t)$ is the density and $a$ is the propagation speed.\n\nLet a uniform grid be\n\n$$\nx_j = j\\,\\Delta x,\\qquad t^n = n\\,\\Delta t,\\qquad u_j^n \\approx u(x_j,t^n),\\qquad\n\\lambda = \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\n\n---\n\n**Pavni:** Last time we derived $u_t + a\\,u_x=0$ from traffic flow. How do we solve it numerically?\n\n**Acharya:** First, try the tempting FTCS (Forward in time, Central in space):\n\n$$\n\\frac{u_j^{n+1}-u_j^n}{\\Delta t} + a\\,\\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0\n\\ \\Longrightarrow\\\nu_j^{n+1} = u_j^n - \\frac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n).\n$$\n\n**Pavni:** It looks symmetric and simple. Why not use it?\n\n**Acharya:** Two reasons:\n\n1. Direction of information (traffic logic). For $a>0$, information travels from left to right. FTCS is symmetric, so it lets the downstream value $u_{j+1}^n$ influence the update equally with the upstream value $u_{j-1}^n$. That clashes with the one-way nature of characteristics.\n\n2. Instability (preview). FTCS for pure advection amplifies some Fourier modes (no built-in damping) and blows up. We will prove this with von Neumann analysis in the next level.\n\n**Pavni:** So our spatial difference should look upstream.\n\n**Acharya:** Exactly. That idea is upwinding.\n\n---\n\n## Deriving the Upwind Scheme\n\n**Acharya:** For $a>0$, approximate $u_x$ by a backward (upwind) difference:\n\n$$\nu_x(x_j,t^n) \\approx \\frac{u_j^n - u_{j-1}^n}{\\Delta x}.\n$$\n\nUse forward Euler in time for $u_t$:\n\n$$\n\\frac{u_j^{n+1}-u_j^n}{\\Delta t} + a\\,\\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0.\n$$\n\n**Pavni:** Rearranging gives the update\n\n$$\n\\boxed{\\,u_j^{n+1} = u_j^n - \\lambda\\,(u_j^n - u_{j-1}^n),\\qquad \\lambda=\\frac{a\\Delta t}{\\Delta x},\\ a>0.\\,}\n$$\n\n**Acharya:** If $a<0$ (information enters from the right), use a forward difference:\n\n$$\n\\boxed{\\,u_j^{n+1} = u_j^n - \\lambda\\,(u_{j+1}^n - u_j^n),\\qquad \\lambda=\\frac{a\\Delta t}{\\Delta x}<0.\\,}\n$$\n\n**Pavni:** So upwind means: differentiate in the direction information arrives from.\n\n---\n\n## What Upwind Does (Qualitative)\n\n**Acharya:** Upwind is stable under a Courant (CFL) constraint and diffusive: sharp fronts smear slightly because the update is a convex combination of $u_j^n$ and its upstream neighbor.\n\n**Pavni:** And FTCS?\n\n**Acharya:** FTCS ignores directionality and is unstable for advection; save it for diffusion-type problems, not for pure transport.\n\n---\n\n<details>\n<summary><strong>Note: CFL condition (preview)</strong></summary>\n\nThe Courant number $\\lambda=a\\Delta t/\\Delta x$ should satisfy\n\n$$\n\\boxed{\\,|\\lambda| \\le 1\\,}\n$$\n\nso that in one time step information does not jump over more than one cell.  \nWe will derive this precisely via von Neumann analysis next time.\n</details>\n\n<details>\n<summary><strong>Note: Boundary conditions</strong></summary>\n\nOn a finite interval, specify inflow data only.  \nFor $a>0$, prescribe $u(0,t)$; the outflow boundary at $x=L$ needs no condition.  \nFor periodic problems, wrap indices: $u_{-1}^n \\equiv u_{N-1}^n$.\n</details>\n\n---\n\n### FTCS (for reference â€” unstable for advection)\n\n$$\nu_j^{n+1}=u_j^n - \\frac{\\lambda}{2}(u_{j+1}^n - u_{j-1}^n)\\quad\\text{(unstable for advection)}.\n$$\n\n- **Upwind, $a>0$:**\n  $$\n  \\boxed{u_j^{n+1}=u_j^n-\\lambda\\,(u_j^n-u_{j-1}^n),\\quad |\\lambda|\\le1.}\n  $$\n\n- **Upwind, $a<0$:**\n  $$\n  \\boxed{u_j^{n+1}=u_j^n-\\lambda\\,(u_{j+1}^n-u_j^n),\\quad |\\lambda|\\le1.}\n  $$\n\n**Pavni:** FTCS is elegant but the wrong tool for traffic.  \n**Acharya:** Upwind respects the flow of information and gives us a reliable first solver.  \n**Pavni:** We have seen that FTCS is unstable for advection and that Upwind works but is diffusive. What is next?\n\n**Acharya:** A classic alternative is Lax-Friedrichs (LF). Think of it as FTCS plus pre-averaging: before updating, we average the two neighbors of $u_j^n$. That adds a touch of numerical viscosity and stabilizes the scheme.\n\n**Pavni:** Pre-averaging? How does that enter the formula?\n\n**Acharya:** Start from the PDE written with forward Euler in time and a central difference for space, but replace $u_j^n$ by the average $\\tfrac12(u_{j+1}^n+u_{j-1}^n)$:\n$$\n\\frac{u_j^{n+1} - \\tfrac12(u_{j+1}^n+u_{j-1}^n)}{\\Delta t}\n\\;+\\; a\\,\\frac{u_{j+1}^n - u_{j-1}^n}{2\\,\\Delta x} \\;=\\; 0.\n$$\n\n**Pavni:** Rearranging gives the update?\n\n**Acharya:** Exactly:\n$$\n\\boxed{~\nu_j^{n+1}\n= \\tfrac12\\,(u_{j+1}^n + u_{j-1}^n)\n- \\tfrac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n).\n~}\n$$\n\n**Pavni:** This looks a lot like FTCS, but with the average replacing $u_j^n$.\n\n**Acharya:** Right, and that averaging is the stabilizer. You can also rewrite LF to make the pieces more transparent:\n$$\nu_j^{n+1}\n= u_j^n\n- \\frac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n)\n+ \\frac{1}{2}\\,(u_{j+1}^n - 2u_j^n + u_{j-1}^n).\n$$\nThe last bracket is a discrete second derivative. It behaves like a diffusion term.\n\n**Pavni:** So LF transports with a central difference and simultaneously smooths with a second difference.\n\n**Acharya:** Precisely. That smoothing damps the modes that made FTCS blow up.\n\n---\n\n## CFL and behavior (what to remember now)\n\n**Acharya:** Like Upwind, LF needs a Courant condition:\n$$\n\\boxed{~|\\lambda| \\le 1.~}\n$$\n\n**Pavni:** And qualitatively?\n\n**Acharya:** Stable and diffusive. Compared to Upwind, LF is typically more diffusive (more smoothing), because the pre-averaging adds extra numerical viscosity.\n\n---\n\n### Lax-Friedrichs (LF) scheme\n$$\n\\boxed{~\nu_j^{n+1}\n= \\tfrac12\\,(u_{j+1}^n + u_{j-1}^n)\n- \\tfrac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n),\\quad\n\\lambda=\\frac{a\\,\\Delta t}{\\Delta x},\\quad |\\lambda|\\le 1.\n~}\n$$\n\n### Equivalent transport + diffusion form\n$$\n\\boxed{~\nu_j^{n+1}\n= u_j^n\n- \\frac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n)\n+ \\frac{1}{2}\\,(u_{j+1}^n - 2u_j^n + u_{j-1}^n).\n~}\n$$\n\n**Comparison cue**\n\n- FTCS: central advection only -> unstable for advection.  \n- Upwind: one-sided advection -> stable, diffusive.  \n- Lax-Friedrichs: central advection + averaging -> stable, more diffusive.\n\n---\n\n## Why diffusive?\n\nA short Taylor analysis shows LF approximately solves\n$$\nu_t + a u_x \\;\\approx\\; \\frac{\\Delta x^2}{2\\Delta t}(1-\\lambda^2)\\,u_{xx},\n$$\nhence the built-in smoothing. (We will derive this formally when we do modified equations.)\n\n**Pavni:** So far we have:\n- FTCS: unstable,  \n- Upwind: stable but diffusive,  \n- Lax-Friedrichs: also stable, but even more diffusive.  \n\nCan we do better?\n\n**Acharya:** Yes. The next natural step is the Lax-Wendroff (LW) scheme.  \nIt aims to achieve second-order accuracy in both time and space without excessive diffusion.\n\n**Pavni:** Sounds good. How do we derive it?\n\n---\n\n### Derivation through Taylor expansion\n\n**Acharya:** Start by expanding $u(x_j,t^{n+1})$ in a Taylor series in time:\n$$\nu_j^{n+1}\n= u_j^n + \\Delta t\\,u_t + \\frac{\\Delta t^2}{2}\\,u_{tt} + \\mathcal{O}(\\Delta t^3).\n$$\n\nNow use the PDE to eliminate time derivatives:\n\n1. From the PDE: $u_t = -a u_x$.  \n2. Differentiate again: $u_{tt} = -a u_{xt} = -a(-a u_{xx}) = a^2 u_{xx}$.\n\nSubstitute back:\n$$\nu_j^{n+1}\n= u_j^n - a\\Delta t\\,u_x + \\frac{a^2\\Delta t^2}{2}\\,u_{xx}.\n$$\n\n**Pavni:** So we approximate $u_x$ and $u_{xx}$ with central differences?\n\n**Acharya:** Exactly:\n$$\nu_x \\approx \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x}, \\qquad\nu_{xx} \\approx \\frac{u_{j+1}^n - 2u_j^n + u_{j-1}^n}{\\Delta x^2}.\n$$\n\nSubstitute these into the Taylor expansion.\n\n---\n\n### The final Lax-Wendroff formula\n\n**Acharya:** Combining all terms gives:\n\n$$\n\\boxed{\nu_j^{n+1}\n= u_j^n\n- \\frac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n)\n+ \\frac{\\lambda^2}{2}\\,(u_{j+1}^n - 2u_j^n + u_{j-1}^n).\n}\n$$\n\n**Pavni:** Same stencil as Lax-Friedrichs. The only difference is the coefficient of that second-difference term.\n\n**Acharya:** Exactly.  \nBoth schemes use $(u_{j+1}-2u_j+u_{j-1})$, but:\n\n| Scheme | Coefficient on $u_{xx}$-like term |\n|:-------|:-----------------------------------|\n| Lax-Friedrichs | $+\\frac{1}{2}$ |\n| Lax-Wendroff | $+\\frac{\\lambda^2}{2}$ |\n\n---\n\n### Accuracy and Stability\n\n**Pavni:** So Lax-Wendroff should be more accurate?\n\n**Acharya:** Yes, it is second-order accurate in both time and space.  \nLike Lax-Friedrichs, it is stable under the same CFL condition:\n\n$$\n\\boxed{|\\lambda| \\le 1.}\n$$\n\nHowever, while LF is diffusive, LW is dispersive: it does not smooth the solution, but may create small oscillations near steep gradients.\n\n---\n\n## Discussion: Diffusion vs. Dispersion\n\n**Pavni:** Why does LW produce oscillations?\n\n**Acharya:** Look at its modified equation.  \nIf we expand the numerical scheme in Taylor series, we find\n\n$$\nu_t + a\\,u_x\n= -\\,\\frac{a\\,\\Delta x^2}{6}\\,(1 - \\lambda^2)\\,u_{xxx} + \\mathcal{O}(\\Delta x^4).\n$$\n\nThat extra term involves the third derivative, not the second.  \nThird derivatives do not damp amplitudes; they shift the phase of waves.\n\n- A $u_{xx}$ term -> diffusion (damps high frequencies).  \n- A $u_{xxx}$ term -> dispersion (distorts wave shape).\n\n**Pavni:** So the oscillations are phase errors, not amplitude errors.\n\n**Acharya:** Exactly.  \nThat is why we say:  \nLax-Friedrichs is diffusive,  \nLax-Wendroff is dispersive.\n\n---\n\n### Lax-Wendroff scheme\n\n$$\n\\boxed{\nu_j^{n+1}\n= u_j^n\n- \\frac{\\lambda}{2}\\,(u_{j+1}^n - u_{j-1}^n)\n+ \\frac{\\lambda^2}{2}\\,(u_{j+1}^n - 2u_j^n + u_{j-1}^n), \\quad |\\lambda|\\le1.\n}\n$$\n\n### Modified equation (reveals dispersion)\n\n$$\n\\boxed{\nu_t + a\\,u_x = -\\frac{a\\,\\Delta x^2}{6}\\,(1 - \\lambda^2)\\,u_{xxx}.\n}\n$$\n\n**Error type summary**\n\n| Scheme | Leading error term | Effect on solution |\n|---------|-------------------|--------------------|\n| Upwind | $u_{xx}$ | Diffusive (smoothing) |\n| Lax-Friedrichs | $u_{xx}$ | More diffusive |\n| Lax-Wendroff | $u_{xxx}$ | Dispersive (oscillatory) |\n\n---\n\n## Problem (Comparison Plot)\n\nWe solve the 1-D linear advection (transport) equation on a periodic domain $x\\in[0,1)$:\n$$\nu_t + a\\,u_x = 0,\n$$\nwith a Gaussian initial condition $u_0(x)=\\exp\\{-100(x-0.3)^2\\}$ and compare three schemes:\n\n- Upwind (first-order upwind; direction chosen by $\\mathrm{sign}(a)$)\n- Lax-Friedrichs (LF)\n- Lax-Wendroff (LW)\n\nWe visualize results for Courant numbers $\\lambda = a\\Delta t/\\Delta x \\in \\{0.5, 1.0, 1.5\\}$.  \nRecall: stable only if $|\\lambda|\\le 1$ (so $\\lambda=1.5$ will show instability).\n\n::: {#cell-helpers .cell execution_count=2}\n\n::: {.cell-output .cell-output-display}\n![](level5_5_Numerics_Hyperbolic_files/figure-html/helpers-output-1.png){#helpers width=971 height=394}\n:::\n:::\n\n\n",
    "supporting": [
      "level5_5_Numerics_Hyperbolic_files"
    ],
    "filters": [],
    "includes": {}
  }
}